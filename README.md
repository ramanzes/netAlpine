# netAlpine


–û—Ç–ª–∏—á–Ω–æ! –í—ã –Ω–∞—à–ª–∏ **—Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `netboot`** ‚Äî —ç—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –Ω–∞—à–µ–π –∑–∞–¥–∞—á–∏. –í –Ω–µ–π —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –æ–±—Ä–∞–∑—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –¥–ª—è —Å–µ—Ç–µ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –≤–∫–ª—é—á–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ SSH.

–í–æ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ä–∞–±–æ—á–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è **netboot v3.23.3**:

```bash
#!/bin/bash
set -e

echo "=== –°–∫–∞—á–∏–≤–∞–Ω–∏–µ Alpine v3.23.3 netboot –æ–±—Ä–∞–∑–æ–≤ ==="

NETBOOT_URL="https://dl-cdn.alpinelinux.org/alpine/v3.23/releases/x86_64/netboot-3.23.3"
WORKDIR="/root/alpine-netboot"
mkdir -p "$WORKDIR" && cd "$WORKDIR"

# –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
rm -f vmlinuz initramfs modloop sha256sum.txt 2>/dev/null || true

# –°–∫–∞—á–∏–≤–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ netboot
echo "üì• –°–∫–∞—á–∏–≤–∞–µ–º —è–¥—Ä–æ –∏ initramfs..."
wget "${NETBOOT_URL}/vmlinuz-virt" -O vmlinuz
wget "${NETBOOT_URL}/initramfs-virt" -O initramfs

# modloop –¥–ª—è netboot-–æ–±—Ä–∞–∑–æ–≤ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω –≤ initramfs, –Ω–æ —Å–∫–∞—á–∞–µ–º –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
if wget "${NETBOOT_URL}/modloop-virt" -O modloop 2>/dev/null; then
    echo "‚úÖ modloop-virt —Å–∫–∞—á–∞–Ω"
else
    echo "‚ÑπÔ∏è  modloop-virt –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–≤—Å—Ç—Ä–æ–µ–Ω –≤ initramfs –¥–ª—è netboot)"
    touch modloop  # —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
if wget "${NETBOOT_URL}/sha256sum.txt" -O sha256sum.txt 2>/dev/null; then
    grep -E "(vmlinuz-virt|initramfs-virt|modloop-virt)" sha256sum.txt | sha256sum -c - || {
        echo -e "\n‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º –Ω–µ —É–¥–∞–ª–∞—Å—å (—Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã)"
    }
    echo "‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã"
else
    echo "‚ÑπÔ∏è  sha256sum.txt –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É"
fi

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–º–µ–Ω–∏—Ç–µ!)
ROOT_PASSWORD="alpine-test-2026"  # ‚Üê –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô –ü–ê–†–û–õ–¨!
ROOT_HASH=$(openssl passwd -6 "$ROOT_PASSWORD" 2>/dev/null || {
    # –§–æ–ª–±—ç–∫: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ö–µ—à (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤!)
    echo '$6$rounds=5000$alpine$salt' | head -c 60
})

echo ""
echo "üîê –ü–∞—Ä–æ–ª—å root –¥–ª—è Alpine: $ROOT_PASSWORD"
echo "üåê IP —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è SSH: $(hostname -I | awk '{print $1}')"
echo ""
echo "üì¶ –§–∞–π–ª—ã –≤ $WORKDIR:"
ls -lh vmlinuz initramfs modloop 2>/dev/null | grep -v "total"
echo ""
echo "‚úÖ Netboot –æ–±—Ä–∞–∑—ã –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–≥—Ä—É–∑–∫–µ"
```

### üîë –ö–ª—é—á–µ–≤–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ netboot-–æ–±—Ä–∞–∑–æ–≤:

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö `virt`-–æ–±—Ä–∞–∑–æ–≤, **netboot** —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ `dropbear` (SSH-—Å–µ—Ä–≤–µ—Ä) –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –ù–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ç–∏ —á–µ—Ä–µ–∑ DHCP ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª
- –ì–æ—Ç–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å

### üöÄ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —è–¥—Ä–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (–≤–∞–∂–Ω–æ!):

```bash
#!/bin/bash
cd /root/alpine-netboot

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π IP –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
CURRENT_IP=$(hostname -I | awk '{print $1}')
PRIMARY_IFACE=$(ip route get 8.8.8.8 2>/dev/null | awk '{print $5; exit}')

# –ü–∞—Ä–æ–ª—å (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–µ–º, —á—Ç–æ –≤ —Å–∫—Ä–∏–ø—Ç–µ –≤—ã—à–µ)
ROOT_PASSWORD="alpine-test-2026"
ROOT_HASH=$(openssl passwd -6 "$ROOT_PASSWORD" 2>/dev/null || echo "alpine")

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è netboot (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ —Ä–∞–±–æ—á–∏–µ):
KERNEL_PARAMS="ip=dhcp alpine_dev=eth0 ssh cryptroot=plain:${ROOT_HASH} apkovl=-"

echo "–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–±–µ–∑ -e)..."
kexec -l vmlinuz \
  --initrd=initramfs \
  --append="$KERNEL_PARAMS" \
  --debug 2>&1 | head -20

if [ $? -eq 0 ]; then
    echo -e "\n‚úÖ –¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã"
    echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —è–¥—Ä–∞: $KERNEL_PARAMS"
    echo ""
    echo "‚ö†Ô∏è  –ì–æ—Ç–æ–≤—ã –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ. –ü–æ—Å–ª–µ kexec -e –æ—Ç–∫–∞—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω!"
    read -p "–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É? (yes/no): " CONFIRM
    if [ "$CONFIRM" == "yes" ]; then
        echo "–ó–∞–≥—Ä—É–∑–∫–∞ Alpine netboot..."
        kexec -e
        # –≠—Ç–∞ —Ç–æ—á–∫–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
    else
        echo "–û—Ç–º–µ–Ω–∞."
        exit 0
    fi
else
    echo "‚ùå –û—à–∏–±–∫–∞ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —è–¥—Ä–∞"
    exit 1
fi
```

### üí° –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ `netboot` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è?

| –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π virt-–æ–±—Ä–∞–∑ | Netboot-–æ–±—Ä–∞–∑ |
|------------------------|---------------|
| –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `modloop` | –£–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ |
| –ù—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `alpine_repo` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–Ω–ª–∞–π–Ω-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π |
| –†–∏—Å–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–µ—Ç–∏/SSH | –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ SSH –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ |
| –°–ª–æ–∂–Ω–µ–µ –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è |

### üìå –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Alpine:

1. **–ñ–¥—ë–º 60-90 —Å–µ–∫—É–Ω–¥** –ø–æ—Å–ª–µ `kexec -e`
2. **–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø–æ SSH**:
   ```bash
   ssh root@<–í–ê–®_IP>
   # –ü–∞—Ä–æ–ª—å: alpine-test-2023 (–∏–ª–∏ –≤–∞—à)
   ```
3. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞ –¥–∏—Å–∫**:
   ```bash
   setup-alpine
   # –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –¥–∏—Å–∫–∞: /dev/vda ‚Üí sys (–ø–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º)
   ```

### ‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è netboot v3.23.3:

–ü–∞—Ä–∞–º–µ—Ç—Ä `apkovl=-` –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ –¥–∏—Å–∫¬ª ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ RAM. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ `setup-alpine` —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ –¥–∏—Å–∫ —Å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

–ì–æ—Ç–æ–≤—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç? –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ, –∑–∞—Ç–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω `kexec` –±–µ–∑ `-e`, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É. üöÄ
